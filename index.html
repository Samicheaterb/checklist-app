<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assessment Checklist</title>
    <meta name="description" content="Simple checklist app for assessments">
    <meta name="theme-color" content="#007AFF">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #007AFF;
            padding-bottom: 10px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .tab.active {
            color: #007AFF;
            border-bottom-color: #007AFF;
            font-weight: 600;
        }
        .tab:hover {
            color: #007AFF;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        .section-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #007AFF;
            margin-bottom: 15px;
        }
        .subsection {
            margin-bottom: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .subsection-title {
            font-weight: bold;
            color: #555;
            margin-bottom: 10px;
        }
        .checkbox-item {
            margin: 8px 0;
            display: flex;
            align-items: center;
        }
        .checkbox-item input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .checkbox-item label {
            cursor: pointer;
            flex: 1;
        }
        .results {
            margin-top: 30px;
            padding: 20px;
            background-color: #e8f4f8;
            border-radius: 8px;
            border: 1px solid #b8d4e0;
        }
        .results h2 {
            color: #0066cc;
            margin-bottom: 15px;
        }
        .result-section {
            margin-bottom: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
        }
        .result-section h3 {
            color: #007AFF;
            margin-bottom: 10px;
        }
        button {
            background-color: #007AFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            margin-right: 10px;
        }
        button:hover {
            background-color: #0051d5;
        }
        .clear-button {
            background-color: #dc3545;
        }
        .clear-button:hover {
            background-color: #c82333;
        }
        /* Configuration Styles */
        .config-form {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .form-group input[type="number"] {
            width: 100px;
        }
        .form-group small {
            color: #666;
            font-size: 12px;
            display: block;
            margin-top: 5px;
        }
        .section-editor {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 6px;
            background-color: white;
        }
        .subsection-editor {
            border: 1px solid #e0e0e0;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .item-list {
            list-style: none;
            padding: 0;
        }
        .item-list li {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .item-list input {
            flex: 1;
            margin-right: 10px;
        }
        .add-button {
            background-color: #28a745;
            font-size: 14px;
            padding: 8px 16px;
        }
        .add-button:hover {
            background-color: #218838;
        }
        .remove-button {
            background-color: #dc3545;
            font-size: 12px;
            padding: 6px 12px;
            margin-left: 10px;
        }
        .remove-button:hover {
            background-color: #c82333;
        }
        .export-import {
            margin-top: 30px;
            padding: 20px;
            background-color: #fff3cd;
            border-radius: 8px;
            border: 1px solid #ffeeba;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .copy-button {
            background-color: #6c757d;
        }
        .copy-button:hover {
            background-color: #5a6268;
        }
        .result-preview {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            font-style: italic;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Assessment Checklist</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('checklist')">Checklist</button>
            <button class="tab" onclick="switchTab('configure')">Configure</button>
            <button class="tab" onclick="switchTab('settings')">Settings</button>
        </div>
        
        <div id="checklist-tab" class="tab-content active">
            <div id="checklistContainer"></div>
            
            <div class="button-group">
                <button onclick="generateResults()">Generate Results</button>
                <button class="clear-button" onclick="clearAll()">Clear All</button>
            </div>
            
            <div id="results" class="results" style="display: none;">
                <h2>Generated Results</h2>
                <div id="resultsContent"></div>
                <button class="copy-button" onclick="copyResults()">Copy to Clipboard</button>
            </div>
        </div>
        
        <div id="configure-tab" class="tab-content">
            <h2>Configure Sections</h2>
            <div id="sectionsEditor"></div>
            <button class="add-button" onclick="addSection()">+ Add New Section</button>
            
            <div class="export-import">
                <h3>Export/Import Configuration</h3>
                <p>Save your configuration to share or backup:</p>
                <div class="button-group">
                    <button onclick="exportConfig()">Export Configuration</button>
                    <button onclick="document.getElementById('importFile').click()">Import Configuration</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importConfig(event)">
                    <button class="clear-button" onclick="resetToDefault()">Reset to Default</button>
                </div>
            </div>
        </div>
        
        <div id="settings-tab" class="tab-content">
            <h2>Settings</h2>
            <div class="config-form">
                <div class="form-group">
                    <label for="itemsPerSentence">Items per sentence</label>
                    <input type="number" id="itemsPerSentence" min="1" max="5" value="2">
                    <small>How many items to include in each sentence before starting a new one</small>
                </div>
                
                <div class="form-group">
                    <label for="sentenceConnector">Sentence connector</label>
                    <select id="sentenceConnector">
                        <option value="and">and</option>
                        <option value="as well as">as well as</option>
                        <option value="along with">along with</option>
                        <option value=",">comma only</option>
                    </select>
                    <small>Word used to connect items within a sentence</small>
                </div>
                
                <div class="form-group">
                    <label for="paragraphConnector">Paragraph connector</label>
                    <select id="paragraphConnector">
                        <option value="Also">Also</option>
                        <option value="Additionally">Additionally</option>
                        <option value="Furthermore">Furthermore</option>
                        <option value="Moreover">Moreover</option>
                    </select>
                    <small>Word used to start additional sentences</small>
                </div>
                
                <div class="form-group">
                    <label for="listFormat">List format for 3+ items</label>
                    <select id="listFormat">
                        <option value="oxford">Oxford comma (a, b, and c)</option>
                        <option value="no-oxford">No Oxford comma (a, b and c)</option>
                        <option value="semicolon">Semicolon (a; b; c)</option>
                    </select>
                    <small>How to format lists with multiple items</small>
                </div>
                
                <div class="form-group">
                    <label for="sectionSuffix">Section title suffix</label>
                    <input type="text" id="sectionSuffix" value=" Section:">
                    <small>Text added after section name in results</small>
                </div>
                
                <div class="form-group">
                    <label for="resultCase">Result text case</label>
                    <select id="resultCase">
                        <option value="sentence">Sentence case</option>
                        <option value="lower">lowercase</option>
                        <option value="title">Title Case</option>
                    </select>
                </div>
                
                <button onclick="saveSettings()">Save Settings</button>
                
                <div class="result-preview">
                    <strong>Preview:</strong>
                    <p id="preview">The candidate is more likely to lose a job and take a risk. Also, the candidate is more likely to lose money.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // default to cut off at 5 items per sentence, if more than 5, split in 2 sentences (so max of one "additionally")
        // Default configuration
        const defaultConfig = {
            sections: [
                {
                    name: "Integrity/Ethics",
                    subsections: [
                        {
                            prefix: "Testing indicated that when compared to other police candidates, this candidate is more likely to ",
                            items: [
                                { id: 1, text: "have skeptical and/or antisocial views of the world" },
                                { id: 2, text: "fail to integrate ethical considerations in their decision-making" },
                                { id: 3, text: "have a history of conflicts with the law and violations of other social norms" },
                                { id: 4, text: "lack commitment to societal rules" },
                                { id: 5, text: "be self-indulgent" },
                                { id: 6, text: "believe that life is unfair and that exploiting opportunities for personal gain is justified" },
                                { id: 7, text: "exhibit difficulties leading to complaints from the public" },
                                { id: 8, text: "report a history of committing theft" },
                                { id: 9, text: "be nonconforming" },
                                { id: 10, text: "stretch the limits of what they can get away with" },
                                { id: 11, text: "have a history of work-related integrity problems" },
                                { id: 12, text: "have a history of disciplinary problems" },
                                { id: 13, text: "feel cheated and victimized by life" },
                                { id: 14, text: "exhibit conduct unbecoming of a police officer" },
                                { id: 15, text: "exhibit difficulties leading to integrity violations" },
                                { id: 16, text: "have sustained internal affairs investigations" },
                                { id: 17, text: "exhibit difficulties leading to investigations about conduct unbecoming a police officer" }
                            ]
                        },
                    ]
                },
                {
                    name: "Emotion Regulation/Stress Tolerance",
                    subsections: [
                        {
                            prefix: "Testing indicated that when compared to other police candidates, this candidate is more likely to ",
                            items: [
                                { id: 18, text: "worry about problems and be uncertain about how to deal with them" },
                                { id: 19, text: "become easily discouraged" },
                                { id: 20, text: "behave in a self-defeating fashion" },
                                { id: 21, text: "be unprepared to take decisive action in times of stress or emergency" },
                                { id: 22, text: "have difficulty coping with stress" },
                                { id: 23, text: "develop physical symptoms in response to stress and worry about their health" },
                                { id: 24, text: "become impatient with others over minor infractions" },
                                { id: 25, text: "become irritated and annoyed by others" },
                                { id: 26, text: "have a history of anger management problems" },
                                { id: 27, text: "experience negative emotions" },
                                { id: 28, text: "overreact to minor frustrations" },
                                { id: 29, text: "have a history of anger management problems" },
                                { id: 30, text: "experience negative emotions" },
                                { id: 31, text: "overreact to minor frustrations" },
                                { id: 32, text: "have a history of adverse childhood experiences" },
                                { id: 33, text: "believe they have been mistreated" },
                                { id: 34, text: "have a history of developmental risk factors" },
                                { id: 35, text: "lack personal meaning and fulfillment in life" },
                                { id: 36, text: "give up in the face of frustration and adversity" },
                                { id: 37, text: "have difficulty coping with complex situations" },
                                { id: 38, text: "be self-defeating" },
                                { id: 39, text: "be dysfunctional under stress" },
                                { id: 40, text: "have a history of mental health concerns" },
                                { id: 41, text: "exhibit difficulties applying instructions appropriately under stressful conditions" },
                                { id: 42, text: "exhibit difficulties performing under stressful conditions" },
                                { id: 43, text: "exhibit problems reacting to situations with proper degree of emotional and behavioral restraint and control" },
                                { id: 44, text: "exhibit anger management problems" },
                                { id: 45, text: "exhibit difficulties performing under stressful conditions" }
                            ]
                        },
                    ]
                },
                {
                    name: "Assertiveness/Persuasiveness",
                    subsections: [
                        {
                            prefix: "Testing indicated that when compared to other police candidates, this candidate is more likely to ",
                            items: [
                                { id: 46, text: "lack confidence in their own abilities" },
                                { id: 47, text: "avoid situations that others generally view as benign and non-intimidating" },
                                { id: 48, text: "be ill at ease dealing with others" },
                                { id: 49, text: "feel inadequate" },
                                { id: 50, text: "be unsure and act hesitantly" },
                                { id: 51, text: "dislike leadership roles" },
                                { id: 52, text: "lack assertiveness" },
                                { id: 53, text: "be seen as reticent, inhibited, and awkward around others" },
                                { id: 54, text: "to acquiesce to others in a group" },
                                { id: 55, text: "to prefer to stay in the background" },
                                { id: 56, text: "exhibit difficulties engaging or confronting subjects in circumstances in which an officer would normally approach or intervene" },
                                { id: 57, text: "exhibit difficulties in demonstrating a command presence and controlling situations requiring order or resolution" },
                                { id: 58, text: "exhibit problems controlling or de-escalating conflict" },
                                { id: 59, text: "exhibit difficulties asserting themselves and taking charge of situations" }
                            ]
                        },
                    ]
                },
                {
                    name: "Social Competence",
                    subsections: [
                        {
                            prefix: "Testing indicated that when compared to other police candidates, this candidate is more likely to ",
                            items: [
                                { id: 60, text: "have difficulty creating and sustaining mutually satisfying relationships" },
                                { id: 61, text: "have a limited social support network" },
                                { id: 62, text: "be demanding" },
                                { id: 63, text: "hold overly suspicious views with others in a variety of contexts" },
                                { id: 64, text: "have problems with social competence" },
                                { id: 65, text: "be disengaged from their environment" },
                                { id: 66, text: "be seen by others as socially detached and emotionally distant" },
                                { id: 67, text: "feel maligned by others" },
                                { id: 68, text: "hold overly suspicious views about the motives and actions of others" },
                                { id: 69, text: "be deceitful, manipulative, and opportunistic" },
                                { id: 70, text: "have  history of social competence and teamwork problems" },
                                { id: 71, text: "be moralistic and judgemental" },
                                { id: 72, text: "to avoid close interpersonal relationships" },
                                { id: 73, text: "find fault in others without justification" },
                                { id: 74, text: "exhibit difficulties reading people, listening to others, and adapting their language and approach to the requirements of the situation" },
                                { id: 75, text: "exhibit difficulties stemming form rude and/or overbearing behavior that results in compliant form the public" },
                                { id: 76, text: "exhibit difficulties interacting effectively with others in a variety of contexts" },
                                { id: 77, text: "exhibit difficulties with interpersonal relations and teamwork" }
                            ]
                        },
                    ]
                },
                {
                    name: "Impulse Control/Attention to Safety",
                    subsections: [
                        {
                            prefix: "Testing indicated that when compared to other police candidates, this candidate is more likely to ",
                            items: [
                                { id: 78, text: "behave impulsively or without adequate consideration of the consequences or implications of their actions" },
                                { id: 79, text: "have a history of physical aggression" },
                                { id: 80, text: "be rebellious and lack discipline" },
                                { id: 81, text: "be unpredictable in behavior and attitudes" },
                                { id: 82, text: "be self-indulgent" },
                                { id: 83, text: "be unable to delay gratification" },
                                { id: 84, text: "be rebellious and non-conforming" },
                                { id: 85, text: "exhibit problems avoiding impulsive and/or unnecessarily risky behavior" },
                                { id: 86, text: "exhibit difficulties with performing duties in a manner conducive to the safety of others" }
                            ]
                        },
                    ]
                },
                {
                    name: "Conscientiousness/Dependability",
                    subsections: [
                        {
                            prefix: "Testing indicated that when compared to other police candidates, this candidate is more likely to ",
                            items: [
                                { id: 87, text: "give up easily and not persevere in the face of challenges" },
                                { id: 88, text: "have a history of absenteeism or tardiness" },
                                { id: 89, text: "have a history of failing to meet obligations" },
                                { id: 90, text: "be non-planful" },
                                { id: 91, text: "avoid seemingly complex challenges when they can" },
                                { id: 92, text: "be unpredictable in behavior and attitudes" },
                                { id: 93, text: "lack ambition and initiative" },
                                { id: 94, text: "have a history of work-related commitment problems" }
                            ]
                        },
                        {
                            prefix: "Testing indicated that when compared to other police candidates, this candidate is more likely to exhibit difficulties",
                            items: [
                                { id: 95, text: "with conscientiousness" },
                                { id: 96, text: "reliably attending court" },
                                { id: 97, text: "with punctuality and attendance" },
                                { id: 98, text: "with reliable work behavior and dependable follow-through" },
                                { id: 99, text: "to exhibit report writing problems" },
                                { id: 100, text: "with initiative and drive, such as obtaining information and evidence needed to solve crimes and explain incidents" },
                                { id: 101, text: "carrying out tasks under non-stressful conditions" },
                                { id: 102, text: "in their dedication to improvement of knowledge and skills" },
                                { id: 103, text: "with knowledge-related field performance" },
                                { id: 104, text: "with performing on knowledge testing" },
                                { id: 105, text: "conforming to standards and procedures" },
                                { id: 106, text: "with conscientious performance of their duties" },
                                { id: 107, text: "with self-initiative and commitment" }
                            ]
                        }
                    ]
                },
                {
                    name: "Adaptability/Flexibility",
                    subsections: [
                        {
                            prefix: "Testing indicated that when compared to other police candidates, this candidate is more likely to ",
                            items: [
                                { id: 108, text: "have a history of job performance problems" },
                                { id: 109, text: "be rigid and inflexible" },
                                { id: 110, text: "exhibit cognitive adaption problems" },
                                { id: 111, text: "exhibit difficulties prioritizing multiple essential functions of the job and performing them in quick succession while maintaining good environmental awareness of vital information, in other words multi-tasking" },
                                { id: 112, text: "exhibit a difficult time making use of their talents" },
                                { id: 113, text: "exhibit difficulties adapting to various on-the-job cognitive demands" },
                                { id: 114, text: "exhibit difficulties with task efficiency and multitasking" },
                                { id: 115, text: "exhibit difficulties with routine driving and navigation" }
                            ]
                        }
                    ]
                },
                {
                    name: "Teamwork",
                    subsections: [
                        {
                            prefix: "Testing indicated that when compared to other police candidates, this candidate is more likely to ",
                            items: [
                                { id: 116, text: "be self-centered" },
                                { id: 117, text: "have a history of problems getting along with others" },
                                { id: 118, text: "be opinionated and outspoken" },
                                { id: 119, text: "fail to consider other's needs" },
                                { id: 120, text: "be demanding" },
                                { id: 121, text: "have difficulty trusting others" },
                                { id: 122, text: "be less likely to reflect on his behavior" },
                                { id: 123, text: "brush off criticism and negative feedback" },
                                { id: 124, text: "engage in conflicts with authority" },
                                { id: 125, text: "prefer working out problems alone" },
                                { id: 126, text: "project blame onto others" },
                                { id: 127, text: "have difficulties with teamwork" },
                                { id: 128, text: "have a history of interpersonal problems at work" },
                                { id: 129, text: "transfer or project blame onto others" },
                                { id: 130, text: "be disrespectful of others and question their motives" },
                                { id: 131, text: "exhibit difficulties accepting and responding to constructive performance feedback" },
                                { id: 132, text: "exhibit difficulties cooperating with peers and/or supervisors" },
                                { id: 133, text: "exhibit difficulties cooperating with peers and supervisors" },
                                { id: 134, text: "exhibit difficulties with interpersonal relations and teamwork" }
                            ]
                        }
                    ]
                },
                {
                    name: "Substance Use and Risk-Taking Behaviors",
                    subsections: [
                        {
                            prefix: "When compared to other police candidates, this candidate is more likely to have a history of",
                            items: [
                                { id: 135, text: "substance use problems" },
                                { id: 136, text: "motor vehicle violations or difficulties" },
                                { id: 137, text: "substance use problems" }
                            ]
                        }
                    ]
                }
            ]
        };

        const defaultSettings = {
            itemsPerSentence: 5,
            sentenceConnector: "and",
            paragraphConnector: "Additionally",
            listFormat: "oxford",
            sectionSuffix: " Section:",
            resultCase: "sentence"
        };

        // Load configuration from localStorage or use default
        let config = JSON.parse(localStorage.getItem('checklistConfig')) || defaultConfig;
        let settings = JSON.parse(localStorage.getItem('checklistSettings')) || defaultSettings;

        // Initialize the app
        function init() {
            renderChecklist();
            renderSectionsEditor();
            loadSettings();
            updatePreview();
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // Render the checklist based on configuration
        function renderChecklist() {
            const container = document.getElementById('checklistContainer');
            container.innerHTML = '';
            
            config.sections.forEach((section, sectionIndex) => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'section';
                
                const sectionTitle = document.createElement('div');
                sectionTitle.className = 'section-title';
                sectionTitle.textContent = section.name;
                sectionDiv.appendChild(sectionTitle);
                
                section.subsections.forEach((subsection, subsectionIndex) => {
                    const subsectionDiv = document.createElement('div');
                    subsectionDiv.className = 'subsection';
                    
                    const subsectionTitle = document.createElement('div');
                    subsectionTitle.className = 'subsection-title';
                    subsectionTitle.textContent = `The ${subsection.prefix}:`;
                    subsectionDiv.appendChild(subsectionTitle);
                    
                    subsection.items.forEach((item, itemIndex) => {
                        const checkboxDiv = document.createElement('div');
                        checkboxDiv.className = 'checkbox-item';
                        
                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.id = `check-${sectionIndex}-${subsectionIndex}-${itemIndex}`;
                        checkbox.dataset.itemId = item.id;
                        
                        const label = document.createElement('label');
                        label.htmlFor = checkbox.id;
                        label.textContent = item.text;
                        
                        checkboxDiv.appendChild(checkbox);
                        checkboxDiv.appendChild(label);
                        subsectionDiv.appendChild(checkboxDiv);
                    });
                    
                    sectionDiv.appendChild(subsectionDiv);
                });
                
                container.appendChild(sectionDiv);
            });
        }

        // Render sections editor
        function renderSectionsEditor() {
            const container = document.getElementById('sectionsEditor');
            container.innerHTML = '';
            
            config.sections.forEach((section, sectionIndex) => {
                const sectionEditor = document.createElement('div');
                sectionEditor.className = 'section-editor';
                
                const sectionHeader = document.createElement('div');
                sectionHeader.innerHTML = `
                    <div class="form-group">
                        <label>Section Name</label>
                        <div style="display: flex; align-items: center;">
                            <input type="text" value="${section.name}" onchange="updateSectionName(${sectionIndex}, this.value)" style="flex: 1;">
                            <button class="remove-button" onclick="removeSection(${sectionIndex})">Remove Section</button>
                        </div>
                    </div>
                `;
                sectionEditor.appendChild(sectionHeader);
                
                section.subsections.forEach((subsection, subsectionIndex) => {
                    const subsectionEditor = document.createElement('div');
                    subsectionEditor.className = 'subsection-editor';
                    
                    subsectionEditor.innerHTML = `
                        <div class="form-group">
                            <label>Prefix</label>
                            <div style="display: flex; align-items: center;">
                                <input type="text" value="${subsection.prefix}" onchange="updateSubsectionPrefix(${sectionIndex}, ${subsectionIndex}, this.value)" style="flex: 1;">
                                <button class="remove-button" onclick="removeSubsection(${sectionIndex}, ${subsectionIndex})">Remove</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Items</label>
                            <ul class="item-list" id="items-${sectionIndex}-${subsectionIndex}"></ul>
                            <button class="add-button" onclick="addItem(${sectionIndex}, ${subsectionIndex})" style="font-size: 12px; padding: 6px 12px;">+ Add Item</button>
                        </div>
                    `;
                    sectionEditor.appendChild(subsectionEditor);
                    
                    // Render items after appending to DOM
                    setTimeout(() => renderItems(sectionIndex, subsectionIndex), 0);
                });
                
                const addSubsectionBtn = document.createElement('button');
                addSubsectionBtn.className = 'add-button';
                addSubsectionBtn.textContent = '+ Add Subsection';
                addSubsectionBtn.onclick = () => addSubsection(sectionIndex);
                addSubsectionBtn.style = 'font-size: 14px; padding: 8px 16px; margin-top: 10px;';
                sectionEditor.appendChild(addSubsectionBtn);
                
                container.appendChild(sectionEditor);
            });
        }

        // Render items for a subsection
        function renderItems(sectionIndex, subsectionIndex) {
            const itemsList = document.getElementById(`items-${sectionIndex}-${subsectionIndex}`);
            if (!itemsList) return;
            
            itemsList.innerHTML = '';
            const items = config.sections[sectionIndex].subsections[subsectionIndex].items;
            
            items.forEach((item, itemIndex) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-weight: bold; min-width: 40px;">ID: ${item.id}</span>
                            <input type="text" value="${item.text}" onchange="updateItemText(${sectionIndex}, ${subsectionIndex}, ${itemIndex}, this.value)" style="flex: 1;" placeholder="Original text">
                            <button class="remove-button" onclick="removeItem(${sectionIndex}, ${subsectionIndex}, ${itemIndex})" style="font-size: 11px; padding: 4px 8px;">Remove</button>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-weight: bold; min-width: 40px;">Override:</span>
                            <input type="text" value="${item.overrideText || ''}" onchange="updateItemOverride(${sectionIndex}, ${subsectionIndex}, ${itemIndex}, this.value)" style="flex: 1;" placeholder="Optional override text for display">
                        </div>
                    </div>
                `;
                itemsList.appendChild(li);
            });
        }

        // Helper function to find the maximum ID in use
        function getMaxId() {
            let maxId = 0;
            config.sections.forEach(section => {
                section.subsections.forEach(subsection => {
                    subsection.items.forEach(item => {
                        if (item.id > maxId) maxId = item.id;
                    });
                });
            });
            return maxId;
        }

        // Configuration update functions
        function updateSectionName(sectionIndex, value) {
            config.sections[sectionIndex].name = value;
            saveConfig();
            renderChecklist();
        }

        function updateSubsectionPrefix(sectionIndex, subsectionIndex, value) {
            config.sections[sectionIndex].subsections[subsectionIndex].prefix = value;
            saveConfig();
            renderChecklist();
        }

        function updateItemText(sectionIndex, subsectionIndex, itemIndex, value) {
            config.sections[sectionIndex].subsections[subsectionIndex].items[itemIndex].text = value;
            saveConfig();
            renderChecklist();
        }

        function updateItemOverride(sectionIndex, subsectionIndex, itemIndex, value) {
            const item = config.sections[sectionIndex].subsections[subsectionIndex].items[itemIndex];
            if (value.trim() === '') {
                delete item.overrideText;
            } else {
                item.overrideText = value;
            }
            saveConfig();
            renderChecklist();
        }

        function addSection() {
            config.sections.push({
                name: "New Section",
                subsections: [{
                    prefix: "candidate",
                    items: [{
                        id: getMaxId() + 1,
                        text: "example item"
                    }]
                }]
            });
            saveConfig();
            renderSectionsEditor();
            renderChecklist();
        }

        function removeSection(sectionIndex) {
            if (confirm('Are you sure you want to remove this section?')) {
                config.sections.splice(sectionIndex, 1);
                saveConfig();
                renderSectionsEditor();
                renderChecklist();
            }
        }

        function addSubsection(sectionIndex) {
            config.sections[sectionIndex].subsections.push({
                prefix: "candidate",
                items: [{
                    id: getMaxId() + 1,
                    text: "example item"
                }]
            });
            saveConfig();
            renderSectionsEditor();
            renderChecklist();
        }

        function removeSubsection(sectionIndex, subsectionIndex) {
            if (confirm('Are you sure you want to remove this subsection?')) {
                config.sections[sectionIndex].subsections.splice(subsectionIndex, 1);
                saveConfig();
                renderSectionsEditor();
                renderChecklist();
            }
        }

        function addItem(sectionIndex, subsectionIndex) {
            config.sections[sectionIndex].subsections[subsectionIndex].items.push({
                id: getMaxId() + 1,
                text: "new item"
            });
            saveConfig();
            renderItems(sectionIndex, subsectionIndex);
            renderChecklist();
        }

        function removeItem(sectionIndex, subsectionIndex, itemIndex) {
            config.sections[sectionIndex].subsections[subsectionIndex].items.splice(itemIndex, 1);
            saveConfig();
            renderItems(sectionIndex, subsectionIndex);
            renderChecklist();
        }

        // Settings functions
        function loadSettings() {
            document.getElementById('itemsPerSentence').value = settings.itemsPerSentence;
            document.getElementById('sentenceConnector').value = settings.sentenceConnector;
            document.getElementById('paragraphConnector').value = settings.paragraphConnector;
            document.getElementById('listFormat').value = settings.listFormat;
            document.getElementById('sectionSuffix').value = settings.sectionSuffix;
            document.getElementById('resultCase').value = settings.resultCase;
        }

        function saveSettings() {
            settings = {
                itemsPerSentence: parseInt(document.getElementById('itemsPerSentence').value),
                sentenceConnector: document.getElementById('sentenceConnector').value,
                paragraphConnector: document.getElementById('paragraphConnector').value,
                listFormat: document.getElementById('listFormat').value,
                sectionSuffix: document.getElementById('sectionSuffix').value,
                resultCase: document.getElementById('resultCase').value
            };
            localStorage.setItem('checklistSettings', JSON.stringify(settings));
            updatePreview();
            alert('Settings saved!');
        }

        function updatePreview() {
            const preview = document.getElementById('preview');
            const connector = settings.sentenceConnector === ',' ? ', ' : ` ${settings.sentenceConnector} `;
            preview.textContent = `The candidate is more likely to lose a job${connector}take a risk. ${settings.paragraphConnector}, the candidate is more likely to lose money.`;
        }

        // Format text based on case setting
        function formatCase(text) {
            switch (settings.resultCase) {
                case 'lower':
                    return text.toLowerCase();
                case 'title':
                    return text.replace(/\w\S*/g, txt => txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase());
                default: // sentence
                    return text.charAt(0).toUpperCase() + text.slice(1);
            }
        }

        // Generate results based on checked items
        function generateResults() {
            const resultsContent = document.getElementById('resultsContent');
            resultsContent.innerHTML = '';
            
            config.sections.forEach((section, sectionIndex) => {
                const sectionResults = [];
                
                section.subsections.forEach((subsection, subsectionIndex) => {
                    const checkedItems = [];
                    
                    subsection.items.forEach((item, itemIndex) => {
                        const checkbox = document.getElementById(`check-${sectionIndex}-${subsectionIndex}-${itemIndex}`);
                        if (checkbox && checkbox.checked) {
                            checkedItems.push(item.overrideText || item.text);
                        }
                    });
                    
                    if (checkedItems.length > 0) {
                        // Create sentences based on settings
                        const sentences = [];
                        for (let i = 0; i < checkedItems.length; i += settings.itemsPerSentence) {
                            const items = checkedItems.slice(i, i + settings.itemsPerSentence);
                            let sentence = `${subsection.prefix} `;
                            
                            if (items.length === 1) {
                                sentence += items[0] + '.';
                            } else if (items.length === 2) {
                                const connector = settings.sentenceConnector === ',' ? ', ' : ` ${settings.sentenceConnector} `;
                                sentence += items[0] + connector + items[1] + '.';
                            } else {
                                // 3 or more items
                                if (settings.listFormat === 'oxford') {
                                    sentence += items.slice(0, -1).join(', ') + ', and ' + items[items.length - 1] + '.';
                                } else if (settings.listFormat === 'no-oxford') {
                                    sentence += items.slice(0, -1).join(', ') + ' and ' + items[items.length - 1] + '.';
                                } else { // semicolon
                                    sentence += items.join('; ') + '.';
                                }
                            }
                            
                            sentences.push(formatCase(sentence));
                        }
                        
                        // Join sentences with paragraph connector
                        let paragraph = sentences[0];
                        for (let i = 1; i < sentences.length; i++) {
                            paragraph += ` ${settings.paragraphConnector}, ` + sentences[i].charAt(0).toLowerCase() + sentences[i].slice(1);
                        }
                        
                        sectionResults.push(paragraph);
                    }
                });
                
                if (sectionResults.length > 0) {
                    const resultSection = document.createElement('div');
                    resultSection.className = 'result-section';
                    
                    const resultTitle = document.createElement('h3');
                    resultTitle.textContent = section.name + settings.sectionSuffix;
                    resultSection.appendChild(resultTitle);
                    
                    const resultText = document.createElement('p');
                    resultText.textContent = sectionResults.join(' ');
                    resultSection.appendChild(resultText);
                    
                    resultsContent.appendChild(resultSection);
                }
            });
            
            // Show results section
            document.getElementById('results').style.display = 'block';
            
            // Scroll to results
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        // Copy results to clipboard
        function copyResults() {
            const resultsContent = document.getElementById('resultsContent');
            const text = Array.from(resultsContent.children).map(section => {
                const title = section.querySelector('h3').textContent;
                const content = section.querySelector('p').textContent;
                return `${title}\n${content}`;
            }).join('\n\n');
            
            navigator.clipboard.writeText(text).then(() => {
                alert('Results copied to clipboard!');
            });
        }

        // Clear all checkboxes
        function clearAll() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            document.getElementById('results').style.display = 'none';
        }

        // Save configuration
        function saveConfig() {
            localStorage.setItem('checklistConfig', JSON.stringify(config));
        }

        // Export configuration
        function exportConfig() {
            const dataStr = JSON.stringify({ config, settings }, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'checklist-config.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // Import configuration
        function importConfig(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (imported.config) {
                        config = imported.config;
                        localStorage.setItem('checklistConfig', JSON.stringify(config));
                    }
                    if (imported.settings) {
                        settings = imported.settings;
                        localStorage.setItem('checklistSettings', JSON.stringify(settings));
                    }
                    renderChecklist();
                    renderSectionsEditor();
                    loadSettings();
                    updatePreview();
                    alert('Configuration imported successfully!');
                } catch (error) {
                    alert('Error importing configuration. Please check the file format.');
                }
            };
            reader.readAsText(file);
        }

        // Reset to default
        function resetToDefault() {
            if (confirm('Are you sure you want to reset to default configuration? This will remove all your custom sections.')) {
                config = defaultConfig;
                settings = defaultSettings;
                saveConfig();
                localStorage.setItem('checklistSettings', JSON.stringify(settings));
                renderChecklist();
                renderSectionsEditor();
                loadSettings();
                updatePreview();
                alert('Reset to default configuration!');
            }
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
