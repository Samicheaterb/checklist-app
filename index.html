<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assessment Checklist</title>
    <meta name="description" content="Simple checklist app for assessments">
    <meta name="theme-color" content="#007AFF">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #007AFF;
            padding-bottom: 10px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .tab.active {
            color: #007AFF;
            border-bottom-color: #007AFF;
            font-weight: 600;
        }
        .tab:hover {
            color: #007AFF;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        .section-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #007AFF;
            margin-bottom: 15px;
        }
        .subsection {
            margin-bottom: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .subsection-title {
            font-weight: bold;
            color: #555;
            margin-bottom: 10px;
        }
        .checkbox-item {
            margin: 8px 0;
            display: flex;
            align-items: center;
        }
        .checkbox-item input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .checkbox-item label {
            cursor: pointer;
            flex: 1;
        }
        .results {
            margin-top: 30px;
            padding: 20px;
            background-color: #e8f4f8;
            border-radius: 8px;
            border: 1px solid #b8d4e0;
        }
        .results h2 {
            color: #0066cc;
            margin-bottom: 15px;
        }
        .result-section {
            margin-bottom: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
        }
        .result-section h3 {
            color: #007AFF;
            margin-bottom: 10px;
        }
        button {
            background-color: #007AFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            margin-right: 10px;
        }
        button:hover {
            background-color: #0051d5;
        }
        .clear-button {
            background-color: #dc3545;
        }
        .clear-button:hover {
            background-color: #c82333;
        }
        /* Configuration Styles */
        .config-form {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .form-group input[type="number"] {
            width: 100px;
        }
        .form-group small {
            color: #666;
            font-size: 12px;
            display: block;
            margin-top: 5px;
        }
        .section-editor {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 6px;
            background-color: white;
        }
        .subsection-editor {
            border: 1px solid #e0e0e0;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .item-list {
            list-style: none;
            padding: 0;
        }
        .item-list li {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .item-list input {
            flex: 1;
            margin-right: 10px;
        }
        .add-button {
            background-color: #28a745;
            font-size: 14px;
            padding: 8px 16px;
        }
        .add-button:hover {
            background-color: #218838;
        }
        .remove-button {
            background-color: #dc3545;
            font-size: 12px;
            padding: 6px 12px;
            margin-left: 10px;
        }
        .remove-button:hover {
            background-color: #c82333;
        }
        .export-import {
            margin-top: 30px;
            padding: 20px;
            background-color: #fff3cd;
            border-radius: 8px;
            border: 1px solid #ffeeba;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .copy-button {
            background-color: #6c757d;
        }
        .copy-button:hover {
            background-color: #5a6268;
        }
        .result-preview {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            font-style: italic;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Assessment Checklist</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('checklist')">Checklist</button>
            <button class="tab" onclick="switchTab('configure')">Configure</button>
            <button class="tab" onclick="switchTab('settings')">Settings</button>
        </div>
        
        <div id="checklist-tab" class="tab-content active">
            <div id="checklistContainer"></div>
            
            <div class="button-group">
                <button onclick="generateResults()">Generate Results</button>
                <button class="clear-button" onclick="clearAll()">Clear All</button>
            </div>
            
            <div id="results" class="results" style="display: none;">
                <h2>Generated Results</h2>
                <div id="resultsContent"></div>
                <button class="copy-button" onclick="copyResults()">Copy to Clipboard</button>
            </div>
        </div>
        
        <div id="configure-tab" class="tab-content">
            <h2>Configure Sections</h2>
            <div id="sectionsEditor"></div>
            <button class="add-button" onclick="addSection()">+ Add New Section</button>
            
            <div class="export-import">
                <h3>Export/Import Configuration</h3>
                <p>Save your configuration to share or backup:</p>
                <div class="button-group">
                    <button onclick="exportConfig()">Export Configuration</button>
                    <button onclick="document.getElementById('importFile').click()">Import Configuration</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importConfig(event)">
                    <button class="clear-button" onclick="resetToDefault()">Reset to Default</button>
                </div>
            </div>
        </div>
        
        <div id="settings-tab" class="tab-content">
            <h2>Settings</h2>
            <div class="config-form">
                <div class="form-group">
                    <label for="itemsPerSentence">Items per sentence</label>
                    <input type="number" id="itemsPerSentence" min="1" max="5" value="2">
                    <small>How many items to include in each sentence before starting a new one</small>
                </div>
                
                <div class="form-group">
                    <label for="sentenceConnector">Sentence connector</label>
                    <select id="sentenceConnector">
                        <option value="and">and</option>
                        <option value="as well as">as well as</option>
                        <option value="along with">along with</option>
                        <option value=",">comma only</option>
                    </select>
                    <small>Word used to connect items within a sentence</small>
                </div>
                
                <div class="form-group">
                    <label for="paragraphConnector">Paragraph connector</label>
                    <select id="paragraphConnector">
                        <option value="Also">Also</option>
                        <option value="Additionally">Additionally</option>
                        <option value="Furthermore">Furthermore</option>
                        <option value="Moreover">Moreover</option>
                    </select>
                    <small>Word used to start additional sentences</small>
                </div>
                
                <div class="form-group">
                    <label for="listFormat">List format for 3+ items</label>
                    <select id="listFormat">
                        <option value="oxford">Oxford comma (a, b, and c)</option>
                        <option value="no-oxford">No Oxford comma (a, b and c)</option>
                        <option value="semicolon">Semicolon (a; b; c)</option>
                    </select>
                    <small>How to format lists with multiple items</small>
                </div>
                
                <div class="form-group">
                    <label for="sectionSuffix">Section title suffix</label>
                    <input type="text" id="sectionSuffix" value=" Section:">
                    <small>Text added after section name in results</small>
                </div>
                
                <div class="form-group">
                    <label for="resultCase">Result text case</label>
                    <select id="resultCase">
                        <option value="sentence">Sentence case</option>
                        <option value="lower">lowercase</option>
                        <option value="title">Title Case</option>
                    </select>
                </div>
                
                <button onclick="saveSettings()">Save Settings</button>
                
                <div class="result-preview">
                    <strong>Preview:</strong>
                    <p id="preview">The candidate is more likely to lose a job and take a risk. Also, the candidate is more likely to lose money.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Default configuration
        const defaultConfig = {
            sections: [
                {
                    name: "Integrity/Ethics",
                    subsections: [
                        {
                            prefix: "When compared to other police candidates, this candidate is more likely to ",
                            items: [
                                "have skeptical and/or antisocial views of the world",
                                "fail to integrate ethical considerations in their decision-making",
                                "have a history of conflicts with the law and violations of other social norms",
                                "lack commitment to societal rules",
                                "be self-indulgent",
                                "believe that life is unfair and that exploiting opportunities for personal gain is justified",
                                "exhibit difficulties leading to complaints from the public",
                                "report a history of committing theft",
                                "be nonconforming",
                                "stretch the limits of what they can get away with",
                                "have a history of work-related integrity problems",
                                "have a history of disciplinary problems",
                                "feel cheated and victimized by life",
                                "exhibit conduct unbecoming of a police officer",
                                "exhibit difficulties leading to integrity violations",
                                "have sustained internal affairs investigations",
                                "exhibit difficulties leading to investigations about conduct unbecoming a police officer"
                            ]
                        },
                    ]
                },
                {
                    name: "Emotion Regulation/Stress Tolerance",
                    subsections: [
                        {
                            prefix: "When compared to other police candidates, this candidate is more likely to ",
                            items: [
                                "worry about problems and be uncertain about how to deal with them",
                                "become easily discouraged",
                                "behave in a self-defeating fashion",
                                "be unprepared to take decisive action in times of stress or emergency",
                                "have difficulty coping with stress",
                                "develop physical symptoms in response to stress and worry about their health",
                                "become impatient with others over minor infractions",
                                "become irritated and annoyed by others",
                                "have a history of anger management problems",
                                "experience negative emotions",
                                "overreact to minor frustrations",
                                "have a history of anger management problems",
                                "experience negative emotions",
                                "overreact to minor frustrations",
                                "have a history of adverse childhood experiences",
                                "believe they have been mistreated",
                                "have a history of developmental risk factors",
                                "lack personal meaning and fulfillment in life",
                                "give up in the face of frustration and adversity",
                                "have difficulty coping with complex situations",
                                "be self-defeating",
                                "be dysfunctional under stress",
                                "have a history of mental health concerns",
                                "exhibit difficulties applying instructions appropriately under stressful conditions",
                                "exhibit difficulties performing under stressful conditions",
                                "exhibit problems reacting to situations with proper degree of emotional and behavioral restraint and control",
                                "exhibit anger management problems",
                                "exhibit difficulties performing under stressful conditions"
                            ]
                        },
                    ]
                },
                {
                    name: "Assertiveness/Persuasiveness",
                    subsections: [
                        {
                            prefix: "When compared to other police candidates, this candidate is more likely to ",
                            items: [
                                "lack confidence in their own abilities",
                                "avoid situations that others generally view as benign and non-intimidating",
                                "be ill at ease dealing with others",
                                "feel inadequate", 
                                "be unsure and act hesitantly",
                                "dislike leadership roles",
                                "lack assertiveness",
                                "be seen as reticent, inhibited, and awkward around others",
                                "to acquiesce to others in a group",
                                "to prefer to stay in the background",
                                "exhibit difficulties engaging or confronting subjects in circumstances in which an officer would normally approach or intervene",
                                "exhibit difficulties in demonstrating a command presence and controlling situations requiring order or resolution",
                                "exhibit problems controlling or de-escalating conflict",
                                "exhibit difficulties asserting themselves and taking charge of situations"
                            ]
                        },
                    ]
                },
                {
                    name: "Social Competence",
                    subsections: [
                        {
                            prefix: "When compared to other police candidates, this candidate is more likely to ",
                            items: [
                                "have difficulty creating and sustaining mutually satisfying relationships",
                                "have a limited social support network",
                                "be demanding",
                                "hold overly suspicious views with others in a variety of contexts",
                                "have problems with social competence",
                                "be disengaged from their environment",
                                "be seen by others as socially detached and emotionally distant",
                                "feel maligned by others",
                                "hold overly suspicious views about the motives and actions of others",
                                "be deceitful, manipulative, and opportunistic",
                                "have  history of social competence and teamwork problems",
                                "be moralistic and judgemental",
                                "to avoid close interpersonal relationships",
                                "find fault in others without justification",
                                "exhibit difficulties reading people, listening to others, and adapting their language and approach to the requirements of the situation",
                                "exhibit difficulties stemming form rude and/or overbearing behavior that results in compliant form the public",
                                "exhibit difficulties interacting effectively with others in a variety of contexts",
                                "exhibit difficulties with interpersonal relations and teamwork"
                            ]
                        },
                    ]
                },
                {
                    name: "Impulse Control/Attention to Safety",
                    subsections: [
                        {
                            prefix: "When compared to other police candidates, this candidate is more likely to ",
                            items: [
                                "behave impulsively or without adequate consideration of the consequences or implications of their actions",
                                "have a history of physical aggression",
                                "be rebellious and lack discipline",
                                "be unpredictable in behavior and attitudes",
                                "be self-indulgent",
                                "be unable to delay gratification",
                                "be rebellious and non-conforming",
                                "exhibit problems avoiding impulsive and/or unnecessarily risky behavior",
                                "exhibit difficulties with performing duties in a manner conducive to the safety of others"
                            ]
                        },
                    ]
                },
                {
                    name: "Conscientiousness/Dependability",
                    subsections: [
                        {
                            prefix: "When compared to other police candidates, this candidate is more likely to ",
                            items: [
                                "give up easily and not persevere in the face of challenges",
                                "have a history of absenteeism or tardiness",
                                "have a history of failing to meet obligations",
                                "be non-planful",
                                "avoid seemingly complex challenges when they can",
                                "be unpredictable in behavior and attitudes",
                                "lack ambition and initiative",
                                "have a history of work-related commitment problems",
                            ]
                        },
                        {
                            prefix: "When compared to other police candidates, this candidate is more likely to exhibit difficulties",
                            items: [
                                "with conscientiousness",
                                "reliably attending court",
                                "with punctuality and attendance",
                                "with reliable work behavior and dependable follow-through",
                                "to exhibit report writing problems",
                                "with initiative and drive, such as obtaining information and evidence needed to solve crimes and explain incidents",
                                "carrying out tasks under non-stressful conditions",
                                "in their dedication to improvement of knowledge and skills",
                                "with knowledge-related field performance",
                                "with performing on knowledge testing",
                                "conforming to standards and procedures",
                                "with conscientious performance of their duties",
                                "with self-initiative and commitment"
                            ]
                        },
                        {
                            name: "Adaptability/Flexibility",
                            subsections: [
                                {
                                    prefix: "When compared to other police candidates, this candidate is more likely to ",
                                    items: [
                                        "have a history of job performance problems",
                                        "be rigid and inflexible",
                                        "exhibit cognitive adaption problems",
                                        "exhibit difficulties prioritizing multiple essential functions of the job and performing them in quick succession while maintaining good environmental awareness of vital information, in other words multi-tasking",
                                        "exhibit a difficult time making use of their talents",
                                        "exhibit difficulties adapting to various on-the-job cognitive demands",
                                        "exhibit difficulties with task efficiency and multitasking",
                                        "exhibit difficulties with routine driving and navigation"
                                    ]
                                },
                            ]
                        },
                        {
                            name: "Teamwork",
                            subsections: [
                                {
                                    prefix: "When compared to other police candidates, this candidate is more likely to ",
                                    items: [
                                        "be self-centered",
                                        "have a history of problems getting along with others",
                                        "be opinionated and outspoken",
                                        "fail to consider other's needs",
                                        "be demanding",
                                        "have difficulty trusting others",
                                        "be less likely to reflect on his behavior",
                                        "brush off criticism and negative feedback",
                                        "engage in conflicts with authority",
                                        "prefer working out problems alone",
                                        "project blame onto others",
                                        "have difficulties with teamwork",
                                        "have a history of interpersonal problems at work",
                                        "transfer or project blame onto others",
                                        "be disrespectful of others and question their motives",
                                        "exhibit difficulties accepting and responding to constructive performance feedback",
                                        "exhibit difficulties cooperating with peers and/or supervisors",
                                        "exhibit difficulties cooperating with peers and supervisors",
                                        "exhibit difficulties with interpersonal relations and teamwork"
                                    ]
                                },
                            ]
                        },
                        {
                            name: "Substance Use and Risk-Tasking Behaviors",
                            subsections: [
                                {
                                    prefix: "When compared to other police candidates, this candidate is more likely to have a history of",
                                    items: [
                                        "substance use problems",
                                        "motor vehicle violations or difficulties",
                                        "substance use problems"
                                    ]
                                },
                            ]
                        },
                    ]
                }
            ]
        };

        const defaultSettings = {
            itemsPerSentence: 3,
            sentenceConnector: "and",
            paragraphConnector: "Also",
            listFormat: "oxford",
            sectionSuffix: " Section:",
            resultCase: "sentence"
        };

        // Load configuration from localStorage or use default
        let config = JSON.parse(localStorage.getItem('checklistConfig')) || defaultConfig;
        let settings = JSON.parse(localStorage.getItem('checklistSettings')) || defaultSettings;

        // Initialize the app
        function init() {
            renderChecklist();
            renderSectionsEditor();
            loadSettings();
            updatePreview();
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // Render the checklist based on configuration
        function renderChecklist() {
            const container = document.getElementById('checklistContainer');
            container.innerHTML = '';
            
            config.sections.forEach((section, sectionIndex) => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'section';
                
                const sectionTitle = document.createElement('div');
                sectionTitle.className = 'section-title';
                sectionTitle.textContent = section.name;
                sectionDiv.appendChild(sectionTitle);
                
                section.subsections.forEach((subsection, subsectionIndex) => {
                    const subsectionDiv = document.createElement('div');
                    subsectionDiv.className = 'subsection';
                    
                    const subsectionTitle = document.createElement('div');
                    subsectionTitle.className = 'subsection-title';
                    subsectionTitle.textContent = `The ${subsection.prefix}:`;
                    subsectionDiv.appendChild(subsectionTitle);
                    
                    subsection.items.forEach((item, itemIndex) => {
                        const checkboxDiv = document.createElement('div');
                        checkboxDiv.className = 'checkbox-item';
                        
                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.id = `check-${sectionIndex}-${subsectionIndex}-${itemIndex}`;
                        
                        const label = document.createElement('label');
                        label.htmlFor = checkbox.id;
                        label.textContent = item;
                        
                        checkboxDiv.appendChild(checkbox);
                        checkboxDiv.appendChild(label);
                        subsectionDiv.appendChild(checkboxDiv);
                    });
                    
                    sectionDiv.appendChild(subsectionDiv);
                });
                
                container.appendChild(sectionDiv);
            });
        }

        // Render sections editor
        function renderSectionsEditor() {
            const container = document.getElementById('sectionsEditor');
            container.innerHTML = '';
            
            config.sections.forEach((section, sectionIndex) => {
                const sectionEditor = document.createElement('div');
                sectionEditor.className = 'section-editor';
                
                const sectionHeader = document.createElement('div');
                sectionHeader.innerHTML = `
                    <div class="form-group">
                        <label>Section Name</label>
                        <div style="display: flex; align-items: center;">
                            <input type="text" value="${section.name}" onchange="updateSectionName(${sectionIndex}, this.value)" style="flex: 1;">
                            <button class="remove-button" onclick="removeSection(${sectionIndex})">Remove Section</button>
                        </div>
                    </div>
                `;
                sectionEditor.appendChild(sectionHeader);
                
                section.subsections.forEach((subsection, subsectionIndex) => {
                    const subsectionEditor = document.createElement('div');
                    subsectionEditor.className = 'subsection-editor';
                    
                    subsectionEditor.innerHTML = `
                        <div class="form-group">
                            <label>Prefix</label>
                            <div style="display: flex; align-items: center;">
                                <input type="text" value="${subsection.prefix}" onchange="updateSubsectionPrefix(${sectionIndex}, ${subsectionIndex}, this.value)" style="flex: 1;">
                                <button class="remove-button" onclick="removeSubsection(${sectionIndex}, ${subsectionIndex})">Remove</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Items</label>
                            <ul class="item-list" id="items-${sectionIndex}-${subsectionIndex}"></ul>
                            <button class="add-button" onclick="addItem(${sectionIndex}, ${subsectionIndex})" style="font-size: 12px; padding: 6px 12px;">+ Add Item</button>
                        </div>
                    `;
                    sectionEditor.appendChild(subsectionEditor);
                    
                    // Render items after appending to DOM
                    setTimeout(() => renderItems(sectionIndex, subsectionIndex), 0);
                });
                
                const addSubsectionBtn = document.createElement('button');
                addSubsectionBtn.className = 'add-button';
                addSubsectionBtn.textContent = '+ Add Subsection';
                addSubsectionBtn.onclick = () => addSubsection(sectionIndex);
                addSubsectionBtn.style = 'font-size: 14px; padding: 8px 16px; margin-top: 10px;';
                sectionEditor.appendChild(addSubsectionBtn);
                
                container.appendChild(sectionEditor);
            });
        }

        // Render items for a subsection
        function renderItems(sectionIndex, subsectionIndex) {
            const itemsList = document.getElementById(`items-${sectionIndex}-${subsectionIndex}`);
            if (!itemsList) return;
            
            itemsList.innerHTML = '';
            const items = config.sections[sectionIndex].subsections[subsectionIndex].items;
            
            items.forEach((item, itemIndex) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <input type="text" value="${item}" onchange="updateItem(${sectionIndex}, ${subsectionIndex}, ${itemIndex}, this.value)">
                    <button class="remove-button" onclick="removeItem(${sectionIndex}, ${subsectionIndex}, ${itemIndex})" style="font-size: 11px; padding: 4px 8px;">Remove</button>
                `;
                itemsList.appendChild(li);
            });
        }

        // Configuration update functions
        function updateSectionName(sectionIndex, value) {
            config.sections[sectionIndex].name = value;
            saveConfig();
            renderChecklist();
        }

        function updateSubsectionPrefix(sectionIndex, subsectionIndex, value) {
            config.sections[sectionIndex].subsections[subsectionIndex].prefix = value;
            saveConfig();
            renderChecklist();
        }

        function updateItem(sectionIndex, subsectionIndex, itemIndex, value) {
            config.sections[sectionIndex].subsections[subsectionIndex].items[itemIndex] = value;
            saveConfig();
            renderChecklist();
        }

        function addSection() {
            config.sections.push({
                name: "New Section",
                subsections: [{
                    prefix: "candidate",
                    items: ["example item"]
                }]
            });
            saveConfig();
            renderSectionsEditor();
            renderChecklist();
        }

        function removeSection(sectionIndex) {
            if (confirm('Are you sure you want to remove this section?')) {
                config.sections.splice(sectionIndex, 1);
                saveConfig();
                renderSectionsEditor();
                renderChecklist();
            }
        }

        function addSubsection(sectionIndex) {
            config.sections[sectionIndex].subsections.push({
                prefix: "candidate",
                items: ["example item"]
            });
            saveConfig();
            renderSectionsEditor();
            renderChecklist();
        }

        function removeSubsection(sectionIndex, subsectionIndex) {
            if (confirm('Are you sure you want to remove this subsection?')) {
                config.sections[sectionIndex].subsections.splice(subsectionIndex, 1);
                saveConfig();
                renderSectionsEditor();
                renderChecklist();
            }
        }

        function addItem(sectionIndex, subsectionIndex) {
            config.sections[sectionIndex].subsections[subsectionIndex].items.push("new item");
            saveConfig();
            renderItems(sectionIndex, subsectionIndex);
            renderChecklist();
        }

        function removeItem(sectionIndex, subsectionIndex, itemIndex) {
            config.sections[sectionIndex].subsections[subsectionIndex].items.splice(itemIndex, 1);
            saveConfig();
            renderItems(sectionIndex, subsectionIndex);
            renderChecklist();
        }

        // Settings functions
        function loadSettings() {
            document.getElementById('itemsPerSentence').value = settings.itemsPerSentence;
            document.getElementById('sentenceConnector').value = settings.sentenceConnector;
            document.getElementById('paragraphConnector').value = settings.paragraphConnector;
            document.getElementById('listFormat').value = settings.listFormat;
            document.getElementById('sectionSuffix').value = settings.sectionSuffix;
            document.getElementById('resultCase').value = settings.resultCase;
        }

        function saveSettings() {
            settings = {
                itemsPerSentence: parseInt(document.getElementById('itemsPerSentence').value),
                sentenceConnector: document.getElementById('sentenceConnector').value,
                paragraphConnector: document.getElementById('paragraphConnector').value,
                listFormat: document.getElementById('listFormat').value,
                sectionSuffix: document.getElementById('sectionSuffix').value,
                resultCase: document.getElementById('resultCase').value
            };
            localStorage.setItem('checklistSettings', JSON.stringify(settings));
            updatePreview();
            alert('Settings saved!');
        }

        function updatePreview() {
            const preview = document.getElementById('preview');
            const connector = settings.sentenceConnector === ',' ? ', ' : ` ${settings.sentenceConnector} `;
            preview.textContent = `The candidate is more likely to lose a job${connector}take a risk. ${settings.paragraphConnector}, the candidate is more likely to lose money.`;
        }

        // Format text based on case setting
        function formatCase(text) {
            switch (settings.resultCase) {
                case 'lower':
                    return text.toLowerCase();
                case 'title':
                    return text.replace(/\w\S*/g, txt => txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase());
                default: // sentence
                    return text.charAt(0).toUpperCase() + text.slice(1);
            }
        }

        // Generate results based on checked items
        function generateResults() {
            const resultsContent = document.getElementById('resultsContent');
            resultsContent.innerHTML = '';
            
            config.sections.forEach((section, sectionIndex) => {
                const sectionResults = [];
                
                section.subsections.forEach((subsection, subsectionIndex) => {
                    const checkedItems = [];
                    
                    subsection.items.forEach((item, itemIndex) => {
                        const checkbox = document.getElementById(`check-${sectionIndex}-${subsectionIndex}-${itemIndex}`);
                        if (checkbox && checkbox.checked) {
                            checkedItems.push(item);
                        }
                    });
                    
                    if (checkedItems.length > 0) {
                        // Create sentences based on settings
                        const sentences = [];
                        for (let i = 0; i < checkedItems.length; i += settings.itemsPerSentence) {
                            const items = checkedItems.slice(i, i + settings.itemsPerSentence);
                            let sentence = `The ${subsection.prefix} `;
                            
                            if (items.length === 1) {
                                sentence += items[0] + '.';
                            } else if (items.length === 2) {
                                const connector = settings.sentenceConnector === ',' ? ', ' : ` ${settings.sentenceConnector} `;
                                sentence += items[0] + connector + items[1] + '.';
                            } else {
                                // 3 or more items
                                if (settings.listFormat === 'oxford') {
                                    sentence += items.slice(0, -1).join(', ') + ', and ' + items[items.length - 1] + '.';
                                } else if (settings.listFormat === 'no-oxford') {
                                    sentence += items.slice(0, -1).join(', ') + ' and ' + items[items.length - 1] + '.';
                                } else { // semicolon
                                    sentence += items.join('; ') + '.';
                                }
                            }
                            
                            sentences.push(formatCase(sentence));
                        }
                        
                        // Join sentences with paragraph connector
                        let paragraph = sentences[0];
                        for (let i = 1; i < sentences.length; i++) {
                            paragraph += ` ${settings.paragraphConnector}, ` + sentences[i].charAt(0).toLowerCase() + sentences[i].slice(1);
                        }
                        
                        sectionResults.push(paragraph);
                    }
                });
                
                if (sectionResults.length > 0) {
                    const resultSection = document.createElement('div');
                    resultSection.className = 'result-section';
                    
                    const resultTitle = document.createElement('h3');
                    resultTitle.textContent = section.name + settings.sectionSuffix;
                    resultSection.appendChild(resultTitle);
                    
                    const resultText = document.createElement('p');
                    resultText.textContent = sectionResults.join(' ');
                    resultSection.appendChild(resultText);
                    
                    resultsContent.appendChild(resultSection);
                }
            });
            
            // Show results section
            document.getElementById('results').style.display = 'block';
            
            // Scroll to results
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        // Copy results to clipboard
        function copyResults() {
            const resultsContent = document.getElementById('resultsContent');
            const text = Array.from(resultsContent.children).map(section => {
                const title = section.querySelector('h3').textContent;
                const content = section.querySelector('p').textContent;
                return `${title}\n${content}`;
            }).join('\n\n');
            
            navigator.clipboard.writeText(text).then(() => {
                alert('Results copied to clipboard!');
            });
        }

        // Clear all checkboxes
        function clearAll() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            document.getElementById('results').style.display = 'none';
        }

        // Save configuration
        function saveConfig() {
            localStorage.setItem('checklistConfig', JSON.stringify(config));
        }

        // Export configuration
        function exportConfig() {
            const dataStr = JSON.stringify({ config, settings }, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'checklist-config.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // Import configuration
        function importConfig(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (imported.config) {
                        config = imported.config;
                        localStorage.setItem('checklistConfig', JSON.stringify(config));
                    }
                    if (imported.settings) {
                        settings = imported.settings;
                        localStorage.setItem('checklistSettings', JSON.stringify(settings));
                    }
                    renderChecklist();
                    renderSectionsEditor();
                    loadSettings();
                    updatePreview();
                    alert('Configuration imported successfully!');
                } catch (error) {
                    alert('Error importing configuration. Please check the file format.');
                }
            };
            reader.readAsText(file);
        }

        // Reset to default
        function resetToDefault() {
            if (confirm('Are you sure you want to reset to default configuration? This will remove all your custom sections.')) {
                config = defaultConfig;
                settings = defaultSettings;
                saveConfig();
                localStorage.setItem('checklistSettings', JSON.stringify(settings));
                renderChecklist();
                renderSectionsEditor();
                loadSettings();
                updatePreview();
                alert('Reset to default configuration!');
            }
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
